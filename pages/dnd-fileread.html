<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>拖拽 - 文件读取</title>
    <link rel="shortcut icon" href="../ico.ico" type="image/x-icon">
    <meta name="viewport" content="initial-scale=1,maximum-scale=1, minimum-scale=1">
    <style>
    article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}
    body,h1,h2,h3,h4,h5,h6,hr,p,blockquote,dl,dt,dd,ul,ol,li,pre,form,figure,fieldset,legend,button,img,input,textarea,th,td{margin:0;padding:0;border:0;}
    a{text-decoration: none;transition: all .3s ease;color: #666;}
    a:hover{color: #333;}
    body{font: 14px/20px "Alright Sans LP","Avenir Next","Helvetica Neue","Microsoft YaHei",sans-serif;color: #666;}
    ::selection{background: #222;color: #fff;}
    ::-webkit-scrollbar{width: 3px;height: 3px;}
    ::-webkit-scrollbar-button{display: none;}
    ::-webkit-scrollbar-thumb{ background: #aaa; }
    ::-webkit-scrollbar-corner{display: none;}
    input{ font: 15px/20px "Alright Sans LP","Avenir Next","Helvetica Neue","Microsoft YaHei",sans-serif; }
    li{list-style: none;}
    .clearfix:after{ content:" "; display:block; height:0; clear:both; visibility: hidden;}

    .box{
        position: relative; float: left;
        height: 300px; width: 48%; margin: 10px 0 10px 1.3%;
        background: #eee; color: #aaa;
        line-height: 300px; text-align: center; font-size: 1.5rem;
        overflow: hidden; transition: background-color .2s ease; cursor: default;
    }
    .box:hover{
        background-color: #dadada;
    }
    .box input{
        position: absolute;
        left: 0; top: 0; bottom: 0; right: 0;
        opacity: 0; cursor: default;
    }
    .row{
        position: relative;
        padding: 10px 24px 10px 60px; margin: 0 1.3% 10px; min-height: 70px;
        background: #eee;
    }
    .files li{
        float: left;
        padding: 2px 6px; margin-right: 6px; border-radius: 3px;
        background: #ddd; cursor: pointer; border: 1px solid #aaa;
    }
    .files li:hover,
    .files .active{
        background: #bbb;
    }
    .row img{
        display: block; margin: 10px auto;
    }
    .title{
        position: absolute; left: 6px; top: 10px;
        writing-mode: vertical-rl; letter-spacing: 1px;
        padding: 6px 4px; border-radius: 2px; background: #444; color: #fff;
    }
    .info p{
        margin: 10px 0;
    }
    .info span{
        cursor: default; font-size: .8rem;
        padding: 2px 4px; background: #eee;
        border: 1px solid #ccc; border-radius: 4px; box-shadow: 1px 1px 2px #bbb;
    }
    .file-content{
        padding: 10px;
        background: #ddd;
        border: 1px solid #bbb; border-radius: 4px;
    }

    </style>
</head>
<body>

    <div class="clearfix">
        <div id="box" class="box">请将文件拖放至此 :)</div>
        <div class="box">
            <p>点击选择文件上传 :)</p>
            <a href="javascript:;"><input id="file" type="file" multiple="true"></a>
        </div>
    </div>

    <div class="row">
        <span class="title">文件信息</span>
        <ul id="files" class="files clearfix">选择任一种方式上传，支持多文件上传。</ul>
        <div class="info">
            <p><b>文件数量：</b><span>0</span></p>
            <p><b>文件名称：</b><span>null</span></p>
            <p><b>类型：</b><span>undefined</span></p>
            <p><b>大小：</b><span>0</span><span>bytes</span></p>
            <p><b>修改时间：</b><span>00:00</span></p>
        </div>
    </div>
    <div class="row">
        <span class="title">文件预览</span>
        <img id="img">
        <p id="text" class="file-content">上传文件后查看文件内容 : )</p>
    </div>


<script>

    var box = document.getElementById('box'),
        files = null,
        type = 0,
        span = document.querySelectorAll('.info span');
        reader = new FileReader();

    box.addEventListener('dragover', function(e){
        e.preventDefault();
        box.textContent = '松开鼠标完成上传 :o';
    });
    box.addEventListener('dragleave', function(e){
        e.preventDefault();
        box.textContent = '请将文件拖放至此 :)';
    });
    box.addEventListener('drop', function(e){
        e.preventDefault();
        box.textContent = '请将文件拖放至此 :)';

        files = e.dataTransfer.files;
        formatNavs(files.length);
        span[0].textContent = files.length;
        readFile(files[0]);
    });

    document.getElementById('file').addEventListener('change', function(e){
        files = this.files;
        var l = files.length;
        if(!l) return;
        formatNavs(l);
        span[0].textContent = l;
        readFile(files[0]);
    });

    document.getElementById('files').addEventListener('click', function(e){
        var el = e.target;
        if( el.tagName == 'LI' && !el.classList.contains('active')){
            document.querySelector('#files .active').classList.remove('active');
            el.classList.add('active');
            readFile(files[el.dataset.i]);
        }
    });

    reader.addEventListener('load', function(e){
        var img = document.getElementById('img'),
            text = document.getElementById('text');

        if(type == 1){
            img.setAttribute('src', e.target.result);
            text.textContent = '图片预览';
        } else if (type == 2){
            img.removeAttribute('src');
            text.textContent = e.target.result;
        }
    });

    function readType(type, name){
        if(type.indexOf('image') > -1){
            return '图片, ' + type.split('/')[1];
        } else if(type.indexOf('text') > -1) {
            return '文本, ' + type.split('/')[1];
        } else {
            if(type != ''){
                return type;
            }
            var suffix = name.split('.');
            return suffix[suffix.length - 1];
        }
        return '识别失败 :(';
    }

    function readFile(file){

        span[1].textContent = file.name;
        span[2].textContent = readType(file.type, file.name);
        span[3].textContent = file.size;
        span[5].textContent = file.lastModifiedDate.toLocaleString();

        if(file.type.indexOf('image') > -1){
            type = 1;
            reader.readAsDataURL(file);
        } else if(file.type.indexOf('text') > -1 || file.type.indexOf('javascript') > -1 || file.type.indexOf('json') > -1){
            type = 2;
            reader.readAsText(file);
        } else {
            document.getElementById('text').textContent = '属于禁止读取的文件类型 :(';
        }
    }

    function formatNavs(l){
        var html = '<li class="active" data-i="0">文件 1</li>';
        for(var i = 1; i< l; i++){
            html += '<li data-i="'+ i +'">文件 '+ (i+1) +'</li>';
        }
        document.getElementById('files').innerHTML = html;
    }

</script>
</body>
</html>
